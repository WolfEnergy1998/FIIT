---
title: "Week_2-2"
output: html_document
date: "2024-03-08"
---

# Task 1

## Data Loading

Task 1: Load players_22.csv data into R by completing the missing code.

```{r}
library(tidyverse)
library(magrittr) # Pipe implementation for R
library(data.table) # Implements %like%

#setwd("...") # Set the correct path to players_22.csv
data <- read_csv("Files/players_22.csv", col_names = TRUE, num_threads = 4) # Read data into R
data # Check that data are properly loaded 
View(data)
```

## Data Transformation

### Task 2:

A quick glance onto data tells us that there are several player_positions per record. To classify a player into one of four classes — offense, defense, midfielder and a goal keeper — use your code from a previous exercise.

```{r}
data %<>% mutate(
  role = case_when(
    .$player_positions %like% "CF|LW|RW|ST|CAM" ~ "Offense",
    .$player_positions %like% "LWB|RWB|LB|RB|CDM" ~ "Defense",
    .$player_positions %like% "GK" ~ "Goal Keeper",
    .default = "Midfielders"
  )
)
```

### Task 3:

Logistic regression models require the dependent variable to be one-hot encoded. Your task is to create a new column role_oneHot, containing 1 for offensive players and 0 for other players. Restrict the dataset to only columns you need.

```{r}
data %<>% 
  mutate(role_oneHot = case_when(
    .$role %like% "Offense" ~ 1,
    .default = 0
  )
)
#alebo mutate(role_oneHot = ifelse(role == "Offense",1,0))

# 1 = offensive player, 0 = every other player
```

```{r}
data[["role_oneHot"]]
```

```{r}
library("ggplot2")
 
ggplot(data,aes(x=skill_dribbling, y=overall, col=role))+geom_point()
```

### Task 4:

Create a multiple logistic regression model to evaluate both hypotheses in one go. Capture the model data into an object and call it (not surprisingly) model.

```{r}
model <- data %>%
  select(overall,preferred_foot,skill_dribbling,role_oneHot) %$%
  glm(role_oneHot ~ skill_dribbling + preferred_foot, data=., family = binomial) # Fill in your code here. 
summary(model)
```

Check the type/class of the `model` object. Apply `summary()`, `str()` and `View()` and `plot()` to review its content. Do you get any meaningful readouts from these functions? Str() is a mess, View( ) is much neater equivalent of str(), summary() and plot() are most meaningfull.

```{r}
#str(model)
#View(model)
plot(model)
```

### Task 5:

Visualize how the logistic function fits onto our data by completing the following code. Without knowing much about the grammar of graphics functions, fill in only variables needed for X and Y axis to be specified.

```{r}
data %>%
  ggplot(., aes(x=skill_dribbling, y=role_oneHot)) + # Define variables for X an Y axix in aes()
  geom_point(position = position_jitter(width = 0.3, height = 0.06), 
             alpha = 0.05, 
             shape = 1, 
             size = 1.5) + 
  stat_smooth(method = glm, method.args = list(family = binomial)) +
  ggtitle("Dribbling Skill Across Player Roles", 
          subtitle = "Offensive players: top, Other players: bottom")
```

### Task 6:

Adapt the previous code to discriminate offensive players only from goal keepers. Has the shape of the S-function changed? If yes, why?

```{r}
data2 = data %>% 
  mutate(role_oneHot = case_when(
    .$role %like% "Offense" ~ 1,
    .$role %like% "Goal Keeper" ~ 0,
  )
) # 1 = offensive player, 0 = Goal Keeper

data2 %>%
  ggplot(., aes(x=skill_dribbling, y=role_oneHot)) + # Define variables for X an Y axix in aes()
  geom_point(position = position_jitter(width = 0.3, height = 0.06), 
             alpha = 0.05, 
             shape = 1, 
             size = 1.5) + 
  stat_smooth(method = glm, method.args = list(family = binomial)) +
  ggtitle("Dribbling Skill Across Player Roles", 
          subtitle = "Offensive players: top, Goal Keeper players: bottom")
```

### Task 7:

Use knowledge from linear regression exercise to retrieve the coefficients of the logistic function. Interpret your findings. You should be intrepreting values like these, or similar.

```{r}
summary(model)$coefficients
```

What does the intercept and slope mean in a logistic function setting?

In which units are the coefficients presented?

What is the "log odd" of a player being offensive if his the skill_dribbling is 0? 0

How much this "log odds" changes with an increase (or decrease) in skill_dribbling by 1? by an 0.092

Has a playing foot preference any effect on player’s class? \### Task 8:

Find where the probabilities are stored inside model. Save them as model.probabilities and print first 10 values.

```{r}
 model.probabilities <- model$fitted.values
 head(model.probabilities)
```

### Task 9:

Convert model.probabilities into one-hot-encoded classes using a cut-off value of 0.5. Save your result as glm.prediction.

```{r}
glm.prediction <- ifelse(model.probabilities >= 0.05, 1, 0)
 # Fill in your code here. 
head(glm.prediction, 10)
```

### Task 10:

Perform a cross-tabulation of observed and predicted classes and calculate the associated statistics. You can use either the table() function with one-hot-encoded (data\$role_oneHot) and predicted classes (glm.prediction), or get all work done with the confusionMatrix() function from the caret package.

```{r}
library(caret)
confusionMatrix(as_factor(glm.prediction), as_factor(data$role_oneHot), positive = "1")
```

```{r}
table(data$role_oneHot,glm.prediction)
```
